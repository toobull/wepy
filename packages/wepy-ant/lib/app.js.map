{"version":3,"sources":["../src/app.js"],"names":["RequestMQ","map","mq","running","MAX_REQUEST","push","param","t","Date","indexOf","Math","random","next","me","length","newone","shift","obj","oldComplete","complete","args","splice","apply","my","request","url","$addons","$interceptors","$pages","wepy","config","$initAPI","promisifyAPI","$initDiffAPI","$wxapp","getApp","addon","name","api","provider","self","noPromiseMethods","stopRecord","pauseVoice","stopVoice","pauseBackgroundAudio","stopBackgroundAudio","showNavigationBarLoading","hideNavigationBarLoading","createAnimation","createContext","createCanvasContext","hideKeyboard","stopPullDownRefresh","k","Object","keys","forEach","key","substr","test","defineProperty","native","get","rst","call","promisify","Promise","reject","fail","scopes","resolve","bak","res","requestfix","STORAGE_API","data","params","setNavigationBarTitle","setNavigationBar","login","getAuthCode","httpRequest","then","code","authCode","catch","getUserInfo","getAuthUserInfo","userInfo","o","success"],"mappings":"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","file":"app.js","sourcesContent":["/**\n * Tencent is pleased to support the open source community by making WePY available.\n * Copyright (C) 2017 THL A29 Limited, a Tencent company. All rights reserved.\n * \n * Licensed under the MIT License (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at\n * http://opensource.org/licenses/MIT\n * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport native from './native';\n\nlet RequestMQ = {\n    map: {},\n    mq: [],\n    running: [],\n    MAX_REQUEST: 5,\n    push (param) {\n        param.t = +new Date();\n        while ((this.mq.indexOf(param.t) > -1 || this.running.indexOf(param.t) > -1)) {\n            param.t += Math.random() * 10 >> 0;\n        }\n        this.mq.push(param.t);\n        this.map[param.t] = param;\n    },\n    next () {\n        let me = this;\n\n        if (this.mq.length === 0)\n            return;\n\n        if (this.running.length < this.MAX_REQUEST - 1) {\n            let newone = this.mq.shift();\n                let obj = this.map[newone];\n                let oldComplete = obj.complete;\n                obj.complete = (...args) => {\n                    me.running.splice(me.running.indexOf(obj.t), 1);\n                    delete me.map[obj.t];\n                    oldComplete && oldComplete.apply(obj, args);\n                    me.next();\n                }\n                this.running.push(obj.t);\n                return my.request(obj);\n        }\n    },\n    request (obj) {\n        let me = this;\n\n        obj = obj || {};\n        obj = (typeof(obj) === 'string') ? {url: obj} : obj;\n\n\n        this.push(obj);\n\n        return this.next();\n    }\n};\n\n\nexport default class {\n\n    $addons = {};\n\n    $interceptors = {};\n\n    $pages = {};\n\n\n\n    $init (wepy, config = {}) {\n        this.$initAPI(wepy, config.promisifyAPI);\n        this.$initDiffAPI(wepy);\n        this.$wxapp = getApp();\n    }\n\n\n    use (addon, ...args) {\n        if (typeof(addon) === 'string' && this[addon]) {\n            this.$addons[addon] = 1;\n            this[addon](args);\n        } else {\n            this.$addons[addon.name] = new addon(args);\n        }\n    }\n\n    intercept (api, provider) {\n        this.$interceptors[api] = provider;\n    }\n\n    promisify () {\n    }\n\n    requestfix () {\n    }\n\n    $initAPI (wepy, promisifyAPI) {\n        var self = this;\n        let noPromiseMethods = {\n            stopRecord: true,\n            pauseVoice: true,\n            stopVoice: true,\n            pauseBackgroundAudio: true,\n            stopBackgroundAudio: true,\n            showNavigationBarLoading: true,\n            hideNavigationBarLoading: true,\n            createAnimation: true,\n            createContext: true,\n            createCanvasContext: true,\n            hideKeyboard: true,\n            stopPullDownRefresh: true\n        };\n        if (promisifyAPI) {\n            for (let k in promisifyAPI) {\n                noPromiseMethods[k] = promisifyAPI[k];\n            }\n        }\n        Object.keys(my).forEach((key) => {\n            if (!noPromiseMethods[key] && key.substr(0, 2) !== 'on' && !(/\\w+Sync$/.test(key))) {\n                Object.defineProperty(native, key, {\n                    get () {\n                        return (obj) => {\n                            obj = obj || {};\n                            if (self.$interceptors[key] && self.$interceptors[key].config) {\n                                let rst = self.$interceptors[key].config.call(self, obj);\n                                if (rst === false) {\n                                    if (self.$addons.promisify) {\n                                        return Promise.reject('aborted by interceptor');\n                                    } else {\n                                        obj.fail && obj.fail('aborted by interceptor');\n                                        return;\n                                    }\n                                }\n                                obj = rst;\n                            }\n                            if (key === 'request') {\n                                obj = (typeof(obj) === 'string') ? {url: obj} : obj;\n                            }\n                            if (key === 'getAuthCode') {\n                                obj.scopes = obj.scopes || 'auth_user'\n                            }\n                            if (typeof obj === 'string') {\n                                return my[key](obj);\n                            }\n                            if (self.$addons.promisify) {\n                                return new Promise((resolve, reject) => {\n                                    let bak = {};\n                                    ['fail', 'success', 'complete'].forEach((k) => {\n                                        bak[k] = obj[k];\n                                        obj[k] = (res) => {\n                                            if (self.$interceptors[key] && self.$interceptors[key][k]) {\n                                                res = self.$interceptors[key][k].call(self, res);\n                                            }\n                                            if (k === 'success')\n                                                resolve(res)\n                                            else if (k === 'fail')\n                                                reject(res);\n                                        };\n                                    });\n                                    if (self.$addons.requestfix && key === 'request') {\n                                        RequestMQ.request(obj);\n                                    } else\n                                        my[key](obj);\n                                });\n                            } else {\n                                let bak = {};\n                                ['fail', 'success', 'complete'].forEach((k) => {\n                                    bak[k] = obj[k];\n                                    obj[k] = (res) => {\n                                        if (self.$interceptors[key] && self.$interceptors[key][k]) {\n                                            res = self.$interceptors[key][k].call(self, res);\n                                        }\n                                        bak[k] && bak[k].call(self, res);\n                                    };\n                                });\n                                if (self.$addons.requestfix && key === 'request') {\n                                    RequestMQ.request(obj);\n                                } else\n                                    my[key](obj);\n                            }\n                        };\n                    }\n                });\n                wepy[key] = native[key];\n            } else {\n                Object.defineProperty(native, key, {\n                    get () { return (...args) => my[key].apply(my, args) }\n                });\n                wepy[key] = native[key];\n            }\n        });\n\n    }\n\n    $initDiffAPI(wepy) {\n        const STORAGE_API = ['getStorageSync', 'setStorageSync', 'removeStorageSync'];\n        let bak = {};\n        STORAGE_API.forEach(api => {\n            bak[api] = wepy[api];\n            wepy[api] = (key, data) => {\n                let params = {};\n                if (typeof key === 'string') {\n                    params.key = key;\n                    if (data) {\n                        params.data = data;\n                    }\n                } else {\n                    params = key;\n                }\n                return bak[api](params);\n            };\n        });\n\n        wepy.setNavigationBarTitle = wepy.setNavigationBar;\n\n        wepy.login = wepy.getAuthCode;\n\n        wepy.request = wepy.httpRequest;\n\n        if (this.$addons.promisify) {\n            wepy.login = () => {\n                return new Promise((resolve, reject) => {\n                    wepy.getAuthCode().then(res => {\n                        res.code = res.authCode;\n                        delete res.authCode;\n                        resolve(res);\n                    }).catch(reject);\n                });\n            };\n            wepy.getUserInfo = () => {\n                return new Promise((resolve, reject) => {\n                    wepy.getAuthUserInfo(res => {\n                        let rst = {};\n                        for (let k in res) {\n                            rst[k === 'avatar' ? 'avatarUrl' : k] = res[k]\n                        }\n                        resolve({\n                            userInfo: rst\n                        })\n                    })\n                })\n            }\n        } else {\n            wepy.login = (o) => {\n                let bak = {\n                    success: o.success,\n                    fail: o.fail,\n                    complete: o.complete\n                };\n                o.success = function (res) {\n                    res.code = res.authCode;\n                    delete res.authCode;\n                    bak.success && bak.success(res);\n                }\n                return wepy.getAuthCode(o);\n            };\n            wepy.getUserInfo = (o) => {\n                let bak = {\n                    success: o.success,\n                    fail: o.fail,\n                    complete: o.complete\n                };\n                o.success = function (res) {\n                    let rst = {};\n                    for (let k in res) {\n                        rst[k === 'avatar' ? 'avatarUrl' : k] = res[k]\n                    }\n                    bak.success && bak.success({userInfo: rst});\n                }\n                return wepy.getAuthUserInfo(o);\n            };\n        }\n\n    }\n}"]}